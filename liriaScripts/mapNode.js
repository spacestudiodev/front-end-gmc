import Liria from "../modules/liria";
import Component from "../modules/liria/component";
import DrawablePath from "../modules/liria/drawablePath";
import Input from "../modules/liria/Input";
import Node from "../modules/liria/node";
import Vector2 from "../modules/liria/vector2";
import HouseNode from "./houseNode";

const mapP1 = "M73.5,73l27-4,19-8h24l14-7,21-1,19-4,10-1,14-2h10l21,4,19,4h13l18,1,49,2,13,6,22,2,29,11s16-2,40,1,35-8,35-8l39-7,7,8a208.38,208.38,0,0,1,19,27c8,14,24,11,24,11l3,2,51-1,18,6s29,13,40,20,20,2,20,2,27,11,41,20,37,12,37,12l66,1,14,4,4,5,23,2s19,1,50-10,44-64,44-64l13-71,16-27,11-9,22,32-10,8,43,56v11l34,105-3,5-9,3-4,5-9,4-6,7-19,17-6-9-3-1-14-16,7-7-5-8,19-48-7-7-45,17,1,13-3,15v39l-5,31s-9,19-11,25-1,9-1,9,26,29,32,37,32,29,32,29l9,17,13,11,30.5-.5,22,13v4l-13-4-5,14-25-14-26-18-110,15-14-34-7-7-4-11-232,29-5,10,11,18,29,81,58,146-109,18-24-168,9-40-21,4-4-3-7,1-76,8,54-65-9-128-42-3-108-20-20,44-30,40-4,9-8,34-5,26-31,95-181,3-36,8v-32l-3-24-14-56-43,11-64,8-11-9-2-11,3-9-6-7,11-97,119-20,9-14,10-20,6-16-64,6v-24H76l-7-79h7l-7-37Z"

const mapP2 = "M603.72,315.81c31.79-2.58,54.28-4.31,54.28-4.31M15.07,410.74C65,404.51,116.51,396.51,141,388.5c0,0,242-46,256-52,1.56-.67,6-1.5,12.69-2.44M384,230.87,353.12,311.5s-6.3,12.66,4.29,34.33M381.06,238.5c15.07-2,91.94,10,91.94,10,112,29,130.72,19.56,130.72,19.56M278,694.5c3-16,61-122,69-130s8-25,8-25l4-49,32-100s4-43,6-49,37-53,37-53,11-24,19-35-.44-29.87-.44-29.87M241,431.5l-7,1c-52-18-103.46,4.92-103.46,4.92M359,490.5s-148,5-166,4-52,8-52,8m235-65.08L302,421.5s-44-18-72,21-37,29-37,29m5.26-45s-6.26,1-5.26,68m81.37,0s4.63-36,9.63-57,5-19-6-41,6.49-35.85,6.49-35.85m363.35,98.42a14.62,14.62,0,0,0-.84-4.57c-4-10-32-58-32-58m0,0s334-43,347-47c5.35-1.65,21.71-20.06,39.11-41.16M842.76,366.63,598.49,208.5M985.32,327S1038,364.5,1048,376.5s32,30,63,46q4.26,2.19,8.57,4M966.39,346.66,991,406.5M819.44,210.37,892,228.5s82-28,87-32,20-17,30-22,91-31,91-31"

const mapP3 = "M992.45,82.47c16-19.24,43.89-36.41,60-45.38M863.78,165.61c-7.76.23-29.14.68-59.78-.11-39-1-64-22-77-26s-40-16-56-25-38-9-82-4-49-30-59-41-54,12-66,15-15-9-38-6-49-7-127.68-18.61S198,56.5,198,56.5,114.39,71.84,70.11,80.35m519,21.17L615,396.5M799.84,641.65,696.13,388.22"

const mapP4 = "M610.15,394.93,615,396.5c-5.24,4.08-24.79,27.05-55,64m36-252-455,48L16.89,280.17M140.24,65,142,70.5l13,143s-10,42.15-20,44.07c0,0,14,9.93-32,78.93M93,216.84,309,198.5l178-18,105-11M299.85,56.5a43.29,43.29,0,0,1-4.85,9c-9,12,16.63,173,16.63,173M489,124.5s-72-7-148-19-104-11-104-11-138,17-150,17c-5.21,0-9.67-1.51-17-.76M520.44,63.63,508,88.5H492s-8.06,46.85,3.47,91.43M277.88,242.06,282,275.5s-2,11,20,19c8.2,3,53.72,17.9,107.63,35.44m-281.7,91.68c-2.08-12.41-3.89-22.88-5-28.26-4-19.86-14-51.86-20-56.86s-43-19-49-32-3.68-31.75-3.68-31.75m90.29,235.7c.31-3.77.39-5.95.39-5.95s-7.48-47.47-13.07-80.88M192,253.5s5,25-5,42-20,52-21,62,9,69,9,69m553.64-302L649,238.5v4l21,210,29.06,204.68m143.7-491.24L764.13,315.72s-8.52-1.57,5.68,60.6c.48,2.1,1,4.26,1.43,6.46M560.1,460.5s110.9-8,109.9-13"

const capa1 = [{"x":353.0903772572471,"y":310.1672588100595},{"x":393.1680262910653,"y":302.2646237893066},{"x":430.42330567461454,"y":305.65146736962924},{"x":462.5983196876799,"y":326.53700278161904},{"x":433.24567532488345,"y":341.2133249630172},{"x":463.7272675477874,"y":363.22780823511454},{"x":410.6667181227324,"y":370.0014953957599},{"x":400.5061873817644,"y":336.13305959253324},{"x":365.5088037184302,"y":342.3422728231248},{"x":360.4285383479462,"y":373.95281290613633},{"x":316.3995718037516,"y":376.7751825564052},{"x":313.5772021534827,"y":339.5199031728559},{"x":276.8863966999872,"y":359.2764907247381},{"x":278.5798184901485,"y":314.6830502504897},{"x":504.3693905116594,"y":310.1672588100595},{"x":510.57860374225095,"y":357.5830689345768},{"x":525.819399853703,"y":335.00411173242566},{"x":561.9457313771446,"y":315.81199811059724},{"x":563.6391531673061,"y":351.3738557039852},{"x":600.3299586208014,"y":347.98701212366257},{"x":633.6339204939744,"y":325.97252885156524},{"x":703.0642138905889,"y":338.9554292428021},{"x":704.1931617506965,"y":309.6027848800057},{"x":748.7866022249449,"y":327.10147671167283},{"x":652.261560185749,"y":289.28172339806974},{"x":609.9260154317157,"y":284.2014580275858},{"x":530.899665224187,"y":273.476453356564},{"x":573.799683908274,"y":280.2501405172093},{"x":461.46937182757233,"y":257.1067093850044},{"x":383.0074955500973,"y":268.96066191613374},{"x":297.20745818192313,"y":269.52513584618754},{"x":519.0457126930576,"y":390.8870308077496},{"x":565.8970488875211,"y":395.40282224817986},{"x":627.9891811934366,"y":384.11334364710433},{"x":703.6286878206428,"y":381.8554479268892},{"x":761.205028686128,"y":376.21070862635145},{"x":667.502356297201,"y":385.24229150721186},{"x":465.98516326800257,"y":403.30545726893274},{"x":365.5088037184302,"y":412.90151407984695},{"x":421.9561967238079,"y":449.5923195333425},{"x":395.99039594133416,"y":473.8646985256549},{"x":467.11411112811015,"y":494.1857600075909},{"x":433.24567532488345,"y":485.7186510567842},{"x":397.6838177314955,"y":521.2805086501721},{"x":441.14831034563633,"y":521.2805086501721},{"x":354.7837990474084,"y":456.93048062404154},{"x":323.1732589643969,"y":499.26602537807486},{"x":328.2535243348809,"y":544.9884137124308},{"x":281.96666207047116,"y":493.62128607753704},{"x":254.87191342788987,"y":471.60680280543977},{"x":278.5798184901485,"y":556.8423662435601},{"x":259.3877048683201,"y":529.183143670925},{"x":218.18110797439434,"y":556.8423662435601},{"x":222.69689941482457,"y":516.2002432796882},{"x":215.35873832412545,"y":483.4607553365691},{"x":521.3036084132727,"y":471.042328875386},{"x":491.9509640504763,"y":443.9475802328047},{"x":536.5444045247247,"y":437.7383670022131},{"x":581.137844998973,"y":445.0765280929122},{"x":581.7023189290269,"y":481.202859616354},{"x":511.7075516023585,"y":514.5068214895268},{"x":556.3009920766069,"y":548.9397312228073},{"x":541.6246698952086,"y":590.7108020467867},{"x":503.2404426515518,"y":563.0515794741517},{"x":440.0193624855288,"y":584.5015888161952},{"x":392.0390784309577,"y":584.5015888161952},{"x":494.2088597706914,"y":628.5305553603898},{"x":524.6904519935954,"y":652.8029343527023},{"x":437.1969928352599,"y":660.1410954434014},{"x":449.0509453663892,"y":626.2726596401747},{"x":355.91274690751595,"y":657.3187257931324},{"x":340.1074768660102,"y":630.788451080605},{"x":336.72063328568754,"y":598.0489631374858},{"x":669.1957780873623,"y":420.2396751705461},{"x":712.0957967714494,"y":428.1423101912989},{"x":744.8352847145684,"y":414.0304619399545},{"x":809.7497866707529,"y":378.4686043465665},{"x":850.3919096346248,"y":366.61465181543724},{"x":813.1366302510755,"y":341.777798893071},{"x":809.1853127406991,"y":312.9896284603284},{"x":851.5208574947324,"y":320.3277895510275},{"x":815.3945259712907,"y":449.59231953334245},{"x":810.3142606008066,"y":522.9739304403336},{"x":826.6840045723661,"y":555.1489444533988},{"x":871.2774450466146,"y":551.1976269430223},{"x":860.5524403755928,"y":484.5897031966766},{"x":884.2603454378515,"y":510.5555039791504},{"x":919.2577291011856,"y":539.9081483419468},{"x":922.6445726815083,"y":463.7041677846869},{"x":876.3577104170985,"y":436.0449452120518},{"x":900.630089409411,"y":387.500187227427},{"x":918.1287812410781,"y":429.83573198146024},{"x":960.4643259951114,"y":417.4173055202771},{"x":929.4182598421536,"y":357.5830689345768},{"x":979.0919656868859,"y":370.00149539575983},{"x":1020.2985625808118,"y":427.5778362612451},{"x":1002.7998707491446,"y":460.31732420436424},{"x":994.8972357283918,"y":494.18576000759083},{"x":1028.2011976015647,"y":519.0226129299571},{"x":1040.055150132694,"y":479.50943782619265},{"x":1064.8920030550603,"y":440.560736652482},{"x":1118.517026410169,"y":459.18837634425665},{"x":1080.132799166512,"y":495.87918179775215},{"x":1136.015718241836,"y":419.1107273104385},{"x":1145.0473011226966,"y":502.65286895839756},{"x":1171.577575835224,"y":456.9304806240416},{"x":1176.6578412057079,"y":406.6923008492554},{"x":1112.872287109631,"y":517.3291911397957},{"x":968.931434945918,"y":536.5213047616242},{"x":871.2774450466145,"y":596.9200152773783},{"x":875.228762556991,"y":660.7055693734551},{"x":883.1313975777439,"y":634.1752946609275},{"x":896.6787718990345,"y":716.0240145187252},{"x":905.7103547798949,"y":688.3647919460901},{"x":897.2432458290883,"y":757.230611412651},{"x":937.3208948629065,"y":784.3253600552323},{"x":898.3721936891959,"y":800.6951040267918},{"x":910.2261462203252,"y":715.4595405886714},{"x":831.1997960127964,"y":598.6134370675396},{"x":795.0734644893546,"y":619.4989724795294},{"x":1101.5828085085554,"y":427.01336233119133},{"x":1046.8288372933391,"y":381.29097399683536},{"x":1092.5512256276952,"y":380.72650006678157},{"x":1185.1249501565146,"y":339.51990317285583},{"x":1227.4604949105478,"y":320.8922634810812},{"x":1200.3657462679666,"y":292.66856697839233},{"x":1236.4920777914085,"y":270.65408370629507},{"x":1269.2315657345275,"y":380.16202613672783},{"x":1209.9618030788808,"y":212.51326891075598},{"x":1182.8670544362994,"y":548.3752572927534},{"x":1146.1762489828038,"y":564.7450012643129}]

const capa2 = [{"x":362,"y":315},{"x":431,"y":332},{"x":587,"y":302},{"x":512,"y":330},{"x":418,"y":445},{"x":229,"y":528},{"x":387,"y":507.00000000000006},{"x":566,"y":445},{"x":681,"y":346},{"x":874,"y":493},{"x":868,"y":641},{"x":904,"y":760},{"x":1024,"y":495.99999999999994},{"x":1006,"y":428},{"x":1087,"y":446},{"x":1202,"y":282},{"x":953,"y":359},{"x":886,"y":371},{"x":914,"y":432},{"x":802,"y":357},{"x":513,"y":553},{"x":412,"y":628},{"x":332,"y":565},{"x":281,"y":279},{"x":262.8527815545054,"y":457.7343366422247},{"x":430.6928849156181,"y":261.0194313851529}]

export default class MapNode extends Node {
    capa = []
    init() {
        Input.onKeyDown((e) => {
            if(e.key === "a") {
                this.addChild(new HouseNode({scale: 1, quality: 1})).transform.position = Liria.get().screenToWorldPos(Input.mousePosition)
                this.capa.push(Liria.get().screenToWorldPos(Input.mousePosition))
            }
            if(e.key === "e")
                console.log(JSON.stringify(this.capa))
        })

        this.transform.position = new Vector2(200, 200)

        this.addComponent(new DrawablePath([{
            path: mapP1,
            fill: "#FFD85C"
        }, {
            path: mapP2,
            stroke: "#ffa626",
            lineWidth: 6,
            lineJoin: "round"
        }, {
            path: mapP3,
            stroke: "#ffa626",
            lineWidth: 8,
            lineJoin: "round",
            lineCap: "round"
        },{
            path: mapP4,
            stroke: "#ffa626",
            lineWidth: 4,
            lineJoin: "round",
            lineCap: "round"
        }]))

        for (let layer of capa1) {
            const hn = this.addChild(new HouseNode({scale: 1, quality: 1}))
            hn.transform.position = new Vector2(layer.x, layer.y)
            hn.addComponent(new ShowByLayer(3))
        }

        for(let layer of capa2) {
            const hn = this.addChild(new HouseNode({scale: 2, quality: 3}))
            hn.transform.position = new Vector2(layer.x, layer.y)
            hn.addComponent(new ShowByLayer(-2, 3))
        }

        //this.addChild(new HouseNode({scale: 2, quality: 3})).addComponent(new FollowMouse())

        //for(let i = 0; i < 200; i++){
        //    const home = this.addChild(new HouseNode())
        //    home.transform.localPosition = new Vector2(Math.random() * 1000 + 100, Math.random() * 500 + 100)
        //}
    }
}

class ShowByLayer extends Component {
    constructor(zPosMin, zPosMax) {
        super()
        this.zPos = zPosMin
        this.zPosMax = zPosMax
    }

    init() {
        Input.onMouseScroll(this.changePosition.bind(this))
        this.dp = this.node.getComponent(DrawablePath)
        this.changePosition()
    }
    
    changePosition(e) {
        const lZPos = this.liria.zPos
        if(lZPos > this.zPos) {
            if (this.zPosMax && lZPos > this.zPosMax)
                this.dp.enable = false
            else
                this.dp.enable = true
        }
        else
            this.dp.enable = false
    }
}

class FollowMouse extends Component {
    update() {
        const nextPos = this.liria.screenToWorldPos(Input.mousePosition)
        this.transform.position = nextPos
    }
}
